<!DOCTYPE html>
    <head>
        <title>Dis-COVID</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style/style.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" 
            integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" 
            crossorigin="anonymous">
        
        <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>
        
        <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
        <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>
        
        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-firestore.js"></script>
        <script>
            firebaseConfig = {
                apiKey: "AIzaSyDAquTNfqjwa8bMBSzmyO_sEaeKhhq0rWQ",
                authDomain: "dis-covid.firebaseapp.com",
                databaseURL: "https://dis-covid.firebaseio.com",
                projectId: "dis-covid",
                storageBucket: "dis-covid.appspot.com",
                messagingSenderId: "93140684291",
                appId: "1:93140684291:web:b740d37d012982f706c836",
                measurementId: "G-ZNYK27S4Z4"
            }; 
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            firebase.analytics();
            // Initialize database
            const db = firebase.firestore();
            //db.settings({timestampsInSnapshots: true});
            //Initializes authentication
            const auth = firebase.auth();
        </script>
        
        <script>
            // listen for auth status changes
            firebase.auth().onAuthStateChanged(user => {
                if(user) {
                    console.log('Not redirecting');
                } else {
                    console.log('Redirecting to index.html');
                    window.location.replace("index.html");
                }
            });
        </script>
    </head>
    
    <body>
        <div class="navbar">
            <a href="all_posts.html" class="left nav-item help" id="indexHelp"><img src="images/logo-long.png" id="logo-image"></a>
            <input type="search" placeholder="Search">
            <!--<a href="profile.html" id="logout-link"><img src="images/profile.png" id="logout-img"></a>
            <a href="favorites.html"><img src="images/heart.png"></a>-->
            <a href="create_post.html" ><img src="images/create-post-image.png"></a>
            <a href="index.html" ><img src="images/login.png" id="logout"></a>
        </div>
        <h1 id="post-result-header">These are the results for: </h1>
        <div class="container">
            <div class="row" id="all-posts">
                
            </div>
        </div>

        <!--Displays all of the posts in 'posts' database-->
        <script>
            const testList = document.querySelector('#all-posts');

            function renderTest(doc) {
                let div = document.createElement('div');
                let a = document.createElement('a');
                let button = document.createElement('button');
                let h2 = document.createElement('h2');
                let image = document.createElement('img');
                let h6 = document.createElement('h6');

                div.className = "col-12 col-lg-4 justify-content-center";
                a.id = "post-link";
                button.className = "post";
                image.id = "post-one-img";

                a.href = doc.data().img_url;
                h2.innerHTML = doc.data().title;
                image.src = doc.data().img_url;
                h6.innerHTML = "Created by: " + doc.data().user;

                button.appendChild(h2);
                button.appendChild(image);
                button.appendChild(h6);
                
                a.appendChild(button);

                div.appendChild(a);
                
                testList.appendChild(div);
            }
            
            let allPosts = db.collection('posts').get().then(snapshot => {
                snapshot.forEach(doc => {
                console.log(doc.id, '=>', doc.data().img_url);
                renderTest(doc);
                });
            })
            .catch(err => {
                console.log('Error getting documents', err);
            });
        </script>

        <script src="js/logout.js"></script>
        <script src="js/logo.js"></script>
    </body>
</html>
